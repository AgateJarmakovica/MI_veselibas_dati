# =====================================================================
# 1. pielikums. Veselības datu kvalitātes noteikumu konfigurācijas fails (rules.yml)
# ---------------------------------------------------------------------
# Šis konfigurācijas fails ir izstrādāts promocijas darba ietvaros ar mērķi
# ilustrēt mākslīgā intelekta balstītu, datu centrētu pieeju veselības
# datu kvalitātes uzlabošanai. Failā definētie noteikumi nosaka validācijas,
# imputācijas un semantiskās standartizācijas procedūras, kas tiek
# izmantotas izstrādātajā prototipā “healthdq-ai”.
#
# Katrs noteikums atbilst vienai no trim pētījumā analizētajām datu kvalitātes
# dimensijām — precizitātei, pilnīgumam un atkārtotai izmantojamībai:
#   - PRECISION: pārbauda datu loģisko un semantisko pareizību (piemēram, ĶMI konsekvenci),
#   - COMPLETENESS: identificē un aizpilda trūkstošās vērtības,
#   - REUSABILITY: nodrošina datu semantisko harmonizāciju atbilstoši standartiem.
#
# Faila struktūra atbilst FAIR un Data-Centric AI principiem, nodrošinot
# reproducējamību, pārskatāmību un datu atkārtotu izmantojamību atvērtās
# zinātnes kontekstā. Šo failu izmanto prototipa noteikumu dzinējs, lai
# automātiski validētu un uzlabotu veselības datus pirms to tālākas analīzes.
# =====================================================================

# =====================================================================
# Data Quality Rules Configuration File
# Project: healthdq-ai (Promocijas darba prototips)
# Author: Agate Jarmakoviča, 2025
# Version: 1.2
# ---------------------------------------------------------------------
# Purpose:
#   Define AI-supported, rule-based data quality validation,
#   imputation, and semantic normalization for healthcare datasets.
#   Focused on three core quality dimensions:
#     - Precision (validity and logical consistency)
#     - Completeness (missing value detection and imputation)
#     - Reusability (semantic harmonization and standardization)
# ---------------------------------------------------------------------
# Based on FAIR and Data-Centric AI principles.
# =====================================================================

metadata:
  dataset: "Healthcare quality dataset"
  author: "Agate Jarmakoviča"
  version: "1.2"
  created: "2025-10-30"
  description: >
    Rule-based and machine-learning assisted framework for improving
    healthcare data quality across precision, completeness, and reusability dimensions.

required_columns:
  - patient_id
  - sex_at_birth
  - birth_date
  - height_cm
  - weight_kg
  - bmi

# ---------------------------------------------------------------------
# PRECISION (validity and logical correctness)
# ---------------------------------------------------------------------
rules:
  # Valid categorical values for sex field
  - name: gender_categorical
    type: categorical
    column: sex_at_birth
    allowed: [F, M, U, female, male, Unknown, Other, None]

  # Birth date must be in the past
  - name: birth_date_past
    type: date_in_past
    column: birth_date

  # Height range based on human physiological limits
  - name: height_range
    type: range
    column: height_cm
    min: 40
    max: 250

  # Weight range based on physiological limits
  - name: weight_range
    type: range
    column: weight_kg
    min: 1
    max: 400

  # BMI must be nonnegative
  - name: bmi_nonnegative
    type: nonnegative
    column: bmi

  # Logical consistency between height, weight, and BMI
  - name: bmi_consistency
    type: derived_consistency
    formula: "weight_kg / ((height_cm/100)**2)"
    target_column: bmi
    tolerance: 0.25  # ±25% tolerance due to measurement variability

  # Derived age range validation
  - name: age_range
    type: derived_range
    derived_from: birth_date
    min: 0
    max: 120

  # ICD-10 format pattern validation (optional)
  - name: icd10_format
    type: regex_optional
    column: icd10_code
    pattern: "^[A-TV-Z][0-9]{2}(\\.[0-9A-Z]{1,2})?$"

# ---------------------------------------------------------------------
# COMPLETENESS (missing data detection and imputation)
# ---------------------------------------------------------------------
imputation:
  strategy:
    height_cm: median
    weight_kg: median
    sex_at_birth: mode
    bmi:
      method: conditional_compute
      condition: "if weight_kg and height_cm available"
      formula: "weight_kg / ((height_cm/100)**2)"

# ---------------------------------------------------------------------
# REUSABILITY (semantic standardization and harmonization)
# ---------------------------------------------------------------------
semantic_maps:
  sex_at_birth:
    female: F
    male: M
    woman: F
    man: M
    Female: F
    Male: M
    f: F
    m: M
    Unknown: U
    Other: U
    none: U
    unspecified: U

# ---------------------------------------------------------------------
# QUALITY METRICS (before and after processing)
# ---------------------------------------------------------------------
metrics:
  # Completeness: measure non-null rate
  - name: completeness_not_null_rate
    type: not_null_rate
    columns: [patient_id, sex_at_birth, birth_date, height_cm, weight_kg, bmi]

  # Precision: measure out-of-range or invalid values
  - name: precision_out_of_range_rate
    type: out_of_range_rate
    columns: [height_cm, weight_kg, bmi]

  # Logical consistency: how many BMI values match derived formula
  - name: logical_consistency_rate
    type: derived_match_rate
    columns: [bmi]

  # Reusability: categorical harmonization success rate
  - name: semantic_standardization_rate
    type: categorical_standardization_rate
    columns: [sex_at_birth]
